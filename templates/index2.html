<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    .btn-choose {
      background: linear-gradient(to right, #89b6da, #c7d6e2); /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏ü‡πâ‡∏≤‡∏™‡∏î */
      color: #003366;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      padding: 8px 16px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0, 123, 255, 0.1);
      transition: 0.3s ease;
      display: inline-block;
      white-space: nowrap;
    }

    .btn-choose:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
      text-decoration: none;
    }


    .btn-back-home {
      background: linear-gradient(to right, #89b6da, #c7d6e2); /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏ü‡πâ‡∏≤‡∏™‡∏î */
      color: #003366;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      padding: 8px 16px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0, 123, 255, 0.1);
      transition: 0.3s ease;
      display: inline-block;
      white-space: nowrap;
      text-decoration: none;
    }
    .btn-back-home:hover {
      background-color: #007bff;
      color: white;
      text-decoration: none;
    }
    .solar-heading {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #0d6efd; /* Bootstrap Blue */
      background: none;
      position: relative;
      line-height: 1.2;
    }
  </style>
</head>

<body class="bg-light py-5">
  <div class="text-center my-4">
    <div class="d-inline-flex flex-wrap justify-content-center gap-2">
      <a href="/" class="btn-back-home">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a href="/Project_Estimation" class="btn-choose text-decoration-none">üìè ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå</a>
      <a href="/Cal_electric_price/" class="btn-choose text-decoration-none">üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</a>
      <a href="/ROI_Cal" class="btn-choose text-decoration-none">üî• ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ROI ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏ô</a>
      <a href="/Solarpanel" class="btn-choose text-decoration-none">üõ†Ô∏è ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ú‡∏á‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå</a>
    </div>
  </div>

    <!-- ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ card ‡∏´‡∏•‡∏±‡∏Å -->
    <div class="card shadow-lg rounded-4 p-4 mx-auto" style="max-width: 960px;">

      <h1 class="solar-heading">‚ö° ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° <span>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</span></h1>

      <form method="POST" action="/Cal_electric_price/" id="electricityForm">

        <div class="mb-3">
          <label for="current_month" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
          <select id="current_month" name="current_month" class="form-select">
            {% for i in range(1, 13) %}
            <option value="{{ i }}" {% if form_data and form_data.current_month == i %} selected {% endif %}>
              {{ ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
              "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"][i-1] }}
            </option>
            {% endfor %}
          </select>          
        </div>

        <div class="mb-3">
          <label for="current_units" class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
          <input type="number" id="current_units" name="current_units" class="form-control" required min="0"
          value="{{ form_data.current_units if form_data else '' }}">    
        </div>

        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="enable_history" name="enable_history"
            {% if form_data and form_data.enable_history %} checked {% endif %} onchange="toggleHistoryInputs()">

          <label class="form-check-label" for="enable_history">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
        </div>

        <div id="history_section" style="display: none;">
          <div class="mb-3">
            <label for="month_count" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á(‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô):</label>
            <select id="month_count" name="month_count" class="form-select" onchange="updateMonthInputs()">
              {% for i in range(1, 7) %}
              <option value="{{ i }}" {% if form_data and form_data.month_count == i %} selected {% endif %}>{{ i }} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
              {% endfor %}
            </select>
            
          </div>

          <div id="month_inputs">
            {% if month_count and month_names and previous_units %}
              {% for i in range(1, month_count + 1) %}
                <div class="mb-2">
                  <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô {{ month_names[i-1] }}:</label>
                  <input type="number" id="month{{i}}" name="month{{i}}" class="form-control" required min="0"
                    value="{{ previous_units[i-1] }}">
                </div>
              {% endfor %}
            {% endif %}
          </div>
        </div>
          

        <hr>
        <h5 class="mb-3 fw-bold text-primary">üí° ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü?</h5>

        <div class="mb-3">
          <label for="reduce_type" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
          <select id="reduce_type" name="reduce_type" class="form-select" onchange="toggleInputFields()">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
            <option value="unit" {% if form_data and form_data.reduce_type == 'unit' %} selected {% endif %}>‡∏•‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
            <option value="money" {% if form_data and form_data.reduce_type == 'money' %} selected {% endif %}>‡∏•‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
          </select>
          
        </div>

        <div id="unit_input" style="display: none;" class="mb-3">
          <label for="reduce_units" class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î:</label>
          <input type="number" id="reduce_units" name="reduce_units" class="form-control"
          value="{{ form_data.reduce_units if form_data else '' }}">
        
        </div>

        <div id="money_input" style="display: none;" class="mb-3">
          <label for="reduce_money" class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î (‡∏ö‡∏≤‡∏ó):</label>
          <input type="number" id="reduce_money" name="reduce_money" class="form-control"
          value="{{ form_data.reduce_money if form_data else '' }}">
        
        </div>

        <input type="hidden" id="month_count_hidden" name="month_count">
        <input type="hidden" id="current_month_hidden" name="current_month">

        <div class="d-flex justify-content-center gap-2 mt-4">
          <button type="submit" class="btn btn-success">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
          <button type="button" class="btn btn-outline-danger" onclick="resetForm()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>
        
      </form>

      {% if individual_costs and individual_costs|length > 0 and previous_units and previous_units|sum > 0 %}
      <div class="card mt-5">
        <div class="card-body">
          <h5 class="card-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</h5>
          <div class="table-responsive">
            <table class="table table-bordered text-center align-middle">
              <thead class="table-light">
                <tr>
                  <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                  <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏´‡∏ô‡πà‡∏ß‡∏¢)</th>
                  <th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (‡∏ö‡∏≤‡∏ó)</th>
                </tr>
              </thead>
              <tbody>
                {% if month_names|length == previous_units|length and month_names|length == individual_costs|length %}
                {% for i in range(month_names|length) %}
                <tr>
                  <td>{{ month_names[i] }}</td>
                  <td>{{ previous_units[i] }}</td>
                  <td>{{ individual_costs[i] }}</td>
                </tr>
                {% endfor %}
                <tr class="table-info">
                  <td><strong>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</strong></td>
                  <td><strong>{{ avg_units | round(2) }}</strong></td>
                  <td><strong>{{ avg_cost | round(2) }}</strong></td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="3" class="text-danger text-center">‚ö† ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endif %}

      {% if reduce_type and (reduce_units > 0 or reduce_money > 0) %}
      <div class="card mt-4">
        <div class="card-body">
          <h5 class="card-title">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü:</h5>
          {% if reduce_type == "unit" %}
          <p><strong>‡∏•‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü:</strong> {{ reduce_units }} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
          <p><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</strong> {{ new_units | round(0) | int }} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
          <p><strong>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÉ‡∏´‡∏°‡πà:</strong> {{ new_cost }} ‡∏ö‡∏≤‡∏ó</p>
          {% elif reduce_type == "money" %}
          <p><strong>‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü:</strong> {{ reduce_money }} ‡∏ö‡∏≤‡∏ó</p>
          <p><strong>‡∏•‡∏î‡πÑ‡∏î‡πâ:</strong> {{ reduced_units }} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
          <p><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</strong> {{ new_units if new_units is not none else 0 }} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
          <p><strong>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÉ‡∏´‡∏°‡πà:</strong> {{ new_cost if new_cost is not none else 0 }} ‡∏ö‡∏≤‡∏ó</p>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <div class="text-center mt-4">
        <button type="button" id="resetFormButton" onclick="resetForm_cal()" class="btn btn-outline-danger" style="display: none;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>
    </div>
  </div>
</div>
<script>
  const previousUnits = {{ (form_data.previous_units if form_data and form_data.previous_units else []) | tojson }};
</script>
<script>
  // ‡∏î‡∏±‡∏Å‡∏ï‡∏≠‡∏ô refresh ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
  window.addEventListener('beforeunload', function (e) {
      navigator.sendBeacon('/Cal_electric_price/reset');
  });
</script>

<script src="{{ url_for('static', filename='script2.js') }}"></script>
</body>
</html>