<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คำนวณค่าไฟฟ้า</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <h2>โปรแกรมคำนวณค่าไฟฟ้าแบบอัตราก้าวหน้า</h2>
    
	
	<form method="POST" action="/" id="electricityForm">


		<label for="user_type">เลือกประเภทผู้ใช้:</label>
		<br>
        <label>
				<input type="radio" name="user_type" value="1.1.1" 
					{% if user_type == "1.1.1" %}checked{% endif %} required>
				1.1.1 (ใช้ไฟไม่เกิน 150 หน่วย)
			</label><br>
	
			<label>
				<input type="radio" name="user_type" value="1.1.2" 
					{% if user_type == "1.1.2" %}checked{% endif %} required>
				1.1.2 (ใช้ไฟเกิน 150 หน่วย)
			</label><br>
		<br>
        <label for="current_month">เลือกเดือนปัจจุบัน:</label>
		<select id="current_month" name="current_month">
				{% for i in range(1, 13) %}
					<option value="{{ i }}" {% if current_month == i %} selected {% endif %}>
						{{ ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
							"กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"][i-1] }}
					</option>
				{% endfor %}
			</select>

        <br><br>
		<!-- กรอกหน่วยไฟฟ้าเดือนปัจจุบัน -->
		<label for="current_units">หน่วยไฟฟ้าเดือนปัจจุบัน:</label>
		<input type="number" id="current_units" name="current_units" required min="0">
		<br><br>

		<!-- Checkbox เปิดใช้งานย้อนหลัง -->
		<label>
			<input type="checkbox" id="enable_history" name="enable_history" onchange="toggleHistoryInputs()"> เปิดใช้งานย้อนหลัง
		</label>
		

		<br><br>

		<!-- ส่วนที่เกี่ยวกับข้อมูลย้อนหลัง (ซ่อนเริ่มต้น) -->
		<div id="history_section" style="display: none;">
			<!-- เลือกจำนวนเดือนย้อนหลัง -->
			<label for="month_count">เลือกจำนวนเดือนย้อนหลัง:</label>
			<select id="month_count" name="month_count" onchange="updateMonthInputs()">
				{% for i in range(1, 7) %}
					<option value="{{ i }}" {% if month_count == i %} selected {% endif %}>
						{{ i }} เดือน
					</option>
				{% endfor %}
			</select>

			<br><br>
			<div id="month_inputs">
					{% for i in range(1, month_count + 1) %}
						<label>หน่วยไฟฟ้าเดือน {{ month_names[i-1] }}:</label>
						<input type="number" name="month{{ i }}" value="{{ previous_units[i-1] }}">
					{% endfor %}
				</div>
		</div>

        <h3>ต้องการลดค่าไฟ?</h3>
        <label for="reduce_type">เลือกประเภท:</label>
        <select id="reduce_type" name="reduce_type" onchange="toggleInputFields()">
            <option value="">-- เลือกประเภท --</option>
            <option value="unit">ลดตามหน่วยไฟฟ้า</option>
            <option value="money">ลดตามจำนวนเงิน</option>
        </select>

        <div id="unit_input" style="display: none;">
            <label for="reduce_units">จำนวนหน่วยที่ต้องการลด:</label>
            <input type="number" id="reduce_units" name="reduce_units">
        </div>

        <div id="money_input" style="display: none;">
            <label for="reduce_money">จำนวนเงินที่ต้องการลด (บาท):</label>
            <input type="number" id="reduce_money" name="reduce_money">
        </div>

		<!-- ใช้ปุ่ม "คำนวณ" ปุ่มเดียว -->
		<br><br>
		<input type="hidden" id="month_count_hidden" name="month_count">
		<input type="hidden" id="current_month_hidden" name="current_month">
		<br>
		<button type="submit">คำนวณ</button>
		<br>
	</form>
	
		<div id="results">
			{% if individual_costs and individual_costs|length > 0 %}
				{% if enable_history and month_count > 0 %}
					<h3>รายละเอียดค่าไฟฟ้าเดือนปัจจุบันและย้อนหลัง {{ month_count }} เดือน</h3>
				{% else %}
					<h3>รายละเอียดค่าไฟฟ้าเดือนปัจจุบัน:</h3>
				{% endif %}
		
				<table border="1">
					<thead>
						<tr>
							<th>เดือน</th>
							<th>หน่วยไฟฟ้า (หน่วย)</th>
							<th>ค่าไฟ (บาท)</th>
						</tr>
					</thead>
					<tbody>
						{% if month_names|length == previous_units|length and month_names|length == individual_costs|length %}
							{% for i in range(month_names|length) %}
								<tr>
									<td>{{ month_names[i] }}</td>
									<td>{{ previous_units[i] }}</td>
									<td>{{ individual_costs[i] }}</td>
								</tr>
							{% endfor %}
							<tr>
								<td><strong>เฉลี่ย</strong></td>
								<td><strong>{{ avg_units | round(2) }}</strong></td>  <!-- ✅ แสดงค่าเฉลี่ยหน่วยไฟฟ้า -->
								<td><strong>{{ avg_cost | round(2) }}</strong></td>  <!-- ✅ แสดงค่าเฉลี่ยค่าไฟ -->
							</tr>
							
						{% else %}
							<tr>
								<td colspan="3" style="color: red;">⚠ ข้อมูลไม่ครบ กรุณาตรวจสอบการส่งค่า</td>
							</tr>
						{% endif %}
					</tbody>
				</table>
			
			{% endif %}
		</div>
		
		<div id="reduced_results">
			{% if reduce_type and (reduce_units > 0 or reduce_money > 0) %}
				<h3>ผลลัพธ์หลังลดค่าไฟ:</h3>
				{% if reduce_type == "unit" %}
					<p><strong>ลดหน่วยไฟ:</strong> {{ reduce_units }} หน่วย</p>
					<p><strong>หน่วยที่เหลือ:</strong> {{ new_units }} หน่วย</p>
					<p><strong>ค่าไฟใหม่:</strong> {{ new_cost }} บาท</p> 
				{% elif reduce_type == "money" %}
					<p><strong>ลดค่าไฟ:</strong> {{ reduce_money }} บาท</p>
					<p><strong>ลดได้:</strong> {{ reduced_units }} หน่วย</p>
					<p><strong>หน่วยที่เหลือ:</strong> {{ new_units if new_units is not none else 0 }} หน่วย</p>
					<p><strong>ค่าไฟใหม่:</strong> {{ new_cost if new_cost is not none else 0 }} บาท</p>
				{% endif %}
			{% endif %}
		</div>
		
		<!-- ✅ ซ่อนปุ่ม "รีเซ็ตข้อมูล" ไว้ก่อน -->
		<br>
		<button type="button" id="resetFormButton" onclick="resetForm_cal()" style="display: none;">รีเซ็ตข้อมูล</button>
		
		</div>
	<script src="{{ url_for('static', filename='script.js') }}"></script>	
</body>
</html>